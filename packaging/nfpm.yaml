name: clusterrebootd
arch: ${ARCH}
platform: linux
version: ${VERSION}
section: admin
priority: optional
description: |
  Cluster Reboot Coordinator daemon that serialises kernel reboots behind etcd locking
  and cluster health gates.
license: Apache-2.0
homepage: https://github.com/clusterrebootd/clusterrebootd
maintainer: Platform SRE Team <sre@example.com>
contents:
  - src: ./dist/clusterrebootd
    dst: /usr/bin/clusterrebootd
    file_info:
      mode: 0755
  - src: ./packaging/config.yaml
    dst: /etc/clusterrebootd/config.yaml
    type: config
    file_info:
      mode: 0640
  - src: ./packaging/systemd/clusterrebootd.service
    dst: /lib/systemd/system/clusterrebootd.service
    file_info:
      mode: 0644
  - src: ./packaging/tmpfiles/clusterrebootd.conf
    dst: /usr/lib/tmpfiles.d/clusterrebootd.conf
    file_info:
      mode: 0644
  - src: ./LICENSE
    dst: /usr/share/licenses/clusterrebootd/LICENSE
    file_info:
      mode: 0644
  - src: ./packaging/docs/README.Debian
    dst: /usr/share/doc/clusterrebootd/README.Debian
    packager: deb
    file_info:
      mode: 0644
  - src: ./docs/PACKAGING_BLUEPRINT.md
    dst: /usr/share/doc/clusterrebootd/PACKAGING_BLUEPRINT.md
    file_info:
      mode: 0644
overrides:
  deb:
    depends:
      - systemd
    recommends:
      - ca-certificates
    scripts:
      preinstall: ./packaging/scripts/deb/preinst
      postinstall: ./packaging/scripts/deb/postinst
      preremove: ./packaging/scripts/deb/prerm
      postremove: ./packaging/scripts/deb/postrm
  rpm:
    depends:
      - systemd
    scripts:
      preinstall: ./packaging/scripts/rpm/preinstall.sh
      postinstall: ./packaging/scripts/rpm/postinstall.sh
      preremove: ./packaging/scripts/rpm/preremove.sh
      postremove: ./packaging/scripts/rpm/postremove.sh
